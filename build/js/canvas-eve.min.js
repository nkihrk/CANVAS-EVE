!function(e){function t(t){for(var i,l,o=t[0],r=t[1],c=t[2],g=0,u=[];g<o.length;g++)l=o[g],Object.prototype.hasOwnProperty.call(a,l)&&a[l]&&u.push(a[l][0]),a[l]=0;for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);for(h&&h(t);u.length;)u.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var e,t=0;t<n.length;t++){for(var s=n[t],i=!0,o=1;o<s.length;o++){var r=s[o];0!==a[r]&&(i=!1)}i&&(n.splice(t--,1),e=l(l.s=s[0]))}return e}var i={},a={0:0},n=[];function l(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,l),s.l=!0,s.exports}l.m=e,l.c=i,l.d=function(e,t,s){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(l.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)l.d(s,i,function(t){return e[t]}.bind(null,i));return s},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var o=window.webpackJsonp=window.webpackJsonp||[],r=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var h=r;n.push([7,1]),s()}([,function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){"use strict";s.r(t);var i=s(0),a=s.n(i);var n=function(e,t){function s(){}return s.prototype={constructor:s,options:{},load(){this.eventReady(),this.eventLoad(),this.eventLoadResize()},eventReady(){t((function(){const s=t(e).height();t(this.body).prepend('<div id="loader-bg" style="position: fixed; z-index: 1;"><div id="loading"><div class="spin-wrapper"><div class="spinner"></div></div></div></div>'),t("#loader-bg, #loader").height(s).css("display","block")}))},eventLoad(){this._event("load",(function(){t("#loader-bg").delay(900).fadeOut(800,(function(){t(this).remove()})),t("#loading").delay(600).fadeOut(300,(function(){t(this).remove()}))}))},eventLoadResize(){this._event("load resize",(function(){const s=`${e.innerHeight-60}px`,i=`${e.innerWidth/2}px`;t("#footer").css({top:s,left:i})}))},_event(s,i){t(e).on(s,i)}},s}(window,a.a);var l=function(e,t){function s(e){const s=e.clientWidth,i=s/2,a=s/2*.15,n=i-a,l=.9*(i-a),o=t(e).offset().left+s/2,r=t(e).offset().top+s/2;this.container=e,this.size=s,this.wheelRadius=i,this.wheelInnerRadius=n,this.wheelThickness=a,this.triangleRadius=l,this.centerX=o,this.centerY=r,this.hue=this.options.hue,this.rgb=this.options.rgb,this.triangleCirclePosX=Math.cos(2*Math.PI/3)*l+s/2,this.triangleCirclePosY=Math.sin(2*Math.PI/3)*l+s/2,this.newCanvasX=null,this.newCanvasY=null,this.$newCanvasId=null,this.$canvasId=null,this.drawPointerEvents=["pointerdown","pointerup","pointercancel","pointermove","pointerover","pointerout","pointerenter","pointerleave","gotpointercapture","lostpointercapture"],this.drawEvents=["MSPointerDown","MSPointerUp","MSPointerCancel","MSPointerMove","MSPointerOver","MSPointerOut","MSPointerEnter","MSPointerLeave","MSGotPointerCapture","MSLostPointerCapture","touchstart","touchmove","touchend","touchenter","touchleave","touchcancel","mouseover","mousemove","mouseout","mouseenter","mouseleave","mousedown","mouseup","focus","blur","click","webkitmouseforcewillbegin","webkitmouseforcedown","webkitmouseforceup","webkitmouseforcechanged"],this.lastBrushPos={x:0,y:0},this.isDrawing=!1,this.useTilt=!1,this.EPenButton={tip:1,barrel:2,middle:4,eraser:32},this.flgs={newcanvas:{newcanvas_flg:!1,create_canvas_avail_flg:!1},brush:{brush_flg:!1,draw_canvas_avail_flg:!1}},this._createWheelCircle(),this._createTriangle(),this._createTriangleCircle()}return s.prototype={constructor:s,options:{hue:0,rgb:[0,0,0],theta:0,brush_size:4,eraser_size:30,canvas_color:"#f0e0d6"},load(){this.drawWheel(),this.drawTriangle(),this.setFlgs(),this.resetFlgs(),this.handleEvents(),this._getTriangleColor()},setFlgs(){const s=this;t(e).on(EVENTNAME_TOUCHSTART,"#color-oekaki",()=>{s._isWheelArea()&&(glFlgs.oekaki.move_wheelcircle_flg=!0,console.log("glFlgs.oekaki.move_wheelcircle_flg is ",glFlgs.oekaki.move_wheelcircle_flg)),s._isTriangleArea()&&(glFlgs.oekaki.move_trianglecircle_flg=!0,console.log("glFlgs.oekaki.move_trianglecircle_flg is ",glFlgs.oekaki.move_trianglecircle_flg))}),t(e).on(EVENTNAME_TOUCHSTART,"#color-wheel-circle",()=>{glFlgs.oekaki.move_wheelcircle_flg=!0,console.log("glFlgs.oekaki.move_wheelcircle_flg is ",glFlgs.oekaki.move_wheelcircle_flg)}),t(e).on(EVENTNAME_TOUCHSTART,"#color-triangle-circle",()=>{glFlgs.oekaki.move_trianglecircle_flg=!0,console.log("glFlgs.oekaki.move_trianglecircle_flg is ",glFlgs.oekaki.move_trianglecircle_flg)}),t(e).on(EVENTNAME_TOUCHSTART,"#reset-res",()=>{!0===s.flgs.newcanvas.newcanvas_flg&&(s.flgs.newcanvas.create_canvas_avail_flg=!0,s.newCanvasX=clientFromZoomX,s.newCanvasY=clientFromZoomY,s._createCanvasWrapper(),console.log("self.flgs.newcanvas.create_canvas_avail_flg is ",s.flgs.newcanvas.create_canvas_avail_flg))}),t(e).on(EVENTNAME_TOUCHSTART,".oekaki-canvas",()=>{!0===s.flgs.brush.brush_flg&&(s.flgs.brush.draw_canvas_avail_flg=!0,console.log("self.flgs.brush.draw_canvas_avail_flg is ",s.flgs.brush.draw_canvas_avail_flg))})},resetFlgs(){const s=this;t(e).on(EVENTNAME_TOUCHEND,()=>{!0===glFlgs.oekaki.move_wheelcircle_flg&&(glFlgs.oekaki.move_wheelcircle_flg=!1,console.log("glFlgs.oekaki.move_wheelcircle_flg is ",glFlgs.oekaki.move_wheelcircle_flg)),!0===glFlgs.oekaki.move_trianglecircle_flg&&(glFlgs.oekaki.move_trianglecircle_flg=!1,console.log("glFlgs.oekaki.move_trianglecircle_flg is ",glFlgs.oekaki.move_trianglecircle_flg)),!0===s.flgs.newcanvas.create_canvas_avail_flg&&(s.flgs.newcanvas.create_canvas_avail_flg=!1,s._createCanvas(),console.log("self.flgs.newcanvas.create_canvas_avail_flg is ",s.flgs.newcanvas.create_canvas_avail_flg))})},handleEvents(){const s=this;if(t(e).on(EVENTNAME_TOUCHSTART,"#color-oekaki",()=>{s._colorWheelArea(),s._colorTriangleArea()}),t(e).on(EVENTNAME_TOUCHSTART,"#newcanvas-oekaki, #brush-oekaki, #eraser-oekaki, #spuit-oekaki, #filldrip-oekaki",(function(e){s._toggleTool(t(this),e)})),t(e).on(EVENTNAME_TOUCHMOVE,()=>{const e=t(s.container).offset().left,i=t(s.container).offset().top,a=e+s.size/2,n=i+s.size/2;s.centerX=a,s.centerY=n,!0===glFlgs.oekaki.move_wheelcircle_flg&&s._updateWheelCircle(),!0===glFlgs.oekaki.move_trianglecircle_flg&&s._updateTriangleCircle(),!0===s.flgs.newcanvas.create_canvas_avail_flg&&s._updateCanvasVal()}),window.PointerEvent)for(let i=0;i<s.drawPointerEvents.length;i++)t(e).on(s.drawPointerEvents[i],".oekaki-canvas",(function(e){if(!0===s.flgs.brush.brush_flg){const i=t(this).find("canvas");s._drawCanvasPointer(i,e)}}));else for(let i=0;i<s.drawEvents.length;i++)t(e).on(s.drawEvents[i],".oekaki-canvas",(function(e){if(!0===s.flgs.brush.brush_flg){const i=t(this).find("canvas");s._drawCanvas(i,e)}}))},drawWheel(){const t=100-this.wheelThickness/this.wheelRadius*100,s=e.getElementById("color-wheel");this._generateConicGradiant(100,1,s),this._generateOverlay(100,t,s)},_generateOverlay(t,s,i){const a=e.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",t),a.setAttribute("cy",t),a.setAttribute("r",s),a.setAttribute("fill","#262533"),i.appendChild(a)},_generateConicGradiant(t,s,i){for(let a=0;a<360*s;a++){const n=e.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",this._describeArc(t,t,t,a/s,(a+2)/s)),n.setAttribute("fill",`hsl(${a/s}, 100%, 50%)`),i.appendChild(n)}},_describeArc(e,t,s,i,a){const n=this._polar2Cartesian(e,t,s,a),l=this._polar2Cartesian(e,t,s,i),o=a-i<=180?"0":"1";return["M",n.x,n.y,"A",s,s,0,o,0,l.x,l.y,"L",e,t,"L",n.x,n.y].join(" ")},_polar2Cartesian(e,t,s,i){const a=(i-90)*Math.PI/180;return{x:e+s*Math.cos(a),y:t+s*Math.sin(a)}},_createWheelCircle(){const t=e.createElement("div"),s=this.wheelInnerRadius+this.wheelThickness/2,{theta:i}=this.options,a=s*Math.cos(i+1.5*Math.PI)+this.size/2,n=s*Math.sin(i+1.5*Math.PI)+this.size/2;t.id="color-wheel-circle",t.style.left=`${a}px`,t.style.top=`${n}px`,this.wheelCircle=t,this.container.appendChild(t)},_colorWheelArea(){this._isWheelArea()&&this._updateWheelCircle()},_isWheelArea(){const e=this.wheelInnerRadius,t=this.wheelRadius,s=this.getDistance(this.centerX,this.centerY,clientX,clientY);return s>e&&t>s},_updateWheelCircle(){const e=this.wheelCircle,t=this.wheelInnerRadius+this.wheelThickness/2,s=this._calculateTheta(),i=t*Math.cos(s)+this.size/2,a=t*Math.sin(s)+this.size/2;e.style.left=`${i}px`,e.style.top=`${a}px`;const n=this._calculateHue();this.hue=n,this._updateTriangle()},_calculateTheta(){const{centerX:e}=this,{centerY:t}=this;return(Math.atan2(clientY-t,clientX-e)/Math.PI*180+(Math.atan2(clientY-t,clientX-e)>0?0:360))/180*Math.PI},_calculateHue(){const{centerX:e}=this,{centerY:t}=this;return Math.atan2(clientY-t,clientX-e)/Math.PI*180+90+(Math.atan2(clientY-t,clientX-e)/Math.PI*180+90>0?0:360)},drawTriangle(){const e=this.triangleCtx,t=Math.cos(2*Math.PI/3)*this.triangleRadius,s=Math.sin(2*Math.PI/3)*this.triangleRadius;e.clearRect(0,0,this.size,this.size),e.save(),e.translate(this.wheelRadius,this.wheelRadius),e.beginPath(),e.moveTo(t,s),e.lineTo(this.triangleRadius,0),e.lineTo(t,-s),e.closePath(),e.stroke(),e.clip(),e.fillRect(-this.wheelRadius,-this.wheelRadius,this.size,this.size);const i=e.createLinearGradient(this.triangleRadius,0,t,0),a=`hsla(${Math.round(this.hue)}, 100%, 50%, `;i.addColorStop(0,`${a}1)`),i.addColorStop(1,`${a}0)`),e.fillStyle=i,e.fillRect(-this.wheelRadius,-this.wheelRadius,this.size,this.size);const n=e.createLinearGradient(t,-s,(t+this.triangleRadius)/2,s/2);n.addColorStop(0,"rgba(255, 255, 255, 1)"),n.addColorStop(1,"rgba(255, 255, 255, 0)"),e.globalCompositeOperation="lighter",e.fillStyle=n,e.fillRect(-this.wheelRadius,-this.wheelRadius,this.size,this.size),e.restore()},_updateTriangle(){this.drawTriangle(),this._setRgb("#test-oekaki")},_createTriangle(){const t=e.createElement("canvas");t.id="color-triangle",t.width=this.size,t.height=this.size;const s=t.getContext("2d");this.triangleCtx=s,this.container.appendChild(t)},_createTriangleCircle(){const t=e.createElement("div");t.id="color-triangle-circle",t.style.left=`${this.triangleCirclePosX}px`,t.style.top=`${this.triangleCirclePosY}px`,this.triangleCircle=t,this.container.appendChild(t)},_colorTriangleArea(){this._isTriangleArea()&&this._updateTriangleCircle()},_isTriangleArea(){const e=clientX-this.centerX,t=clientY-this.centerY,s=Math.cos(2*Math.PI/3)*this.triangleRadius,i=this.triangleRadius,a=(-e+i)/Math.sqrt(3);return e>s&&i>e&&(Math.abs(t)>=0&&a>=Math.abs(t))},_updateTriangleCircle(){const e=clientX-this.centerX,s=clientY-this.centerY,i=Math.cos(2*Math.PI/3)*this.triangleRadius,a=this.triangleRadius;let n=(e-a)/Math.sqrt(3),l=(-e+a)/Math.sqrt(3);n=e<=i?-Math.sin(2*Math.PI/3)*this.triangleRadius:n,l=e<=i?Math.sin(2*Math.PI/3)*this.triangleRadius:l;const o=this.triangleCircle,r=t(this.container),c=r.offset().left,h=r.offset().top,g=clientX-c,u=clientY-h;i<e&&e<a?(o.style.left=`${g}px`,o.style.top=s>=l?`${l+this.size/2}px`:n>=s?`${n+this.size/2}px`:`${u}px`):e<=i?(o.style.left=`${i+this.size/2}px`,o.style.top=l<=s?`${l+this.size/2}px`:s<=n?`${n+this.size/2}px`:`${u}px`):a<=e&&(o.style.left=`${a+this.size/2}px`,o.style.top=`${this.size/2}px`),this.triangleCirclePosX=o.style.left.replace("px",""),this.triangleCirclePosY=o.style.top.replace("px",""),this._setRgb("#test-oekaki")},_setRgb(e){const s=this._getTriangleColor(),i=s[0],a=s[1],n=s[2];this.rgb=[i,a,n],t(e).css("background-color",`rgb(${i},${a},${n})`)},_getRgba(e,t){const s=this.triangleCtx.getImageData(e,t,1,1);return[s.data[0],s.data[1],s.data[2],s.data[3]]},_getTriangleColor(){const e=this.triangleCirclePosX-this.size/2,t=this.triangleCirclePosY-this.size/2,s=Math.cos(2*Math.PI/3)*this.triangleRadius,i=Math.sin(2*Math.PI/3)*this.triangleRadius,a=-Math.tan(Math.PI/6)*e-t-i+Math.tan(Math.PI/6)*s,n=Math.abs(a)*Math.sin(Math.PI/3),l=3*this.triangleRadius/2,o=this.hsl2rgb(this.hue/360,1,.5),r=[255,255,255],c=[];let h;for(let t=0;t<3;t++)h=r[t]*(l-n)/l+o[t]*(l-(this.triangleRadius-e))/l,h=Math.abs(Math.round(h)),c.push(h);return c},getDistance(e,t,s,i){let a=s-e,n=i-t;return a*=a,n*=n,Math.sqrt(a+n)},hsl2rgb(e,t,s){let i,a,n;if(0===t)i=1,a=1,n=s;else{const l=function(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e},o=s<.5?s*(1+t):s+t-s*t,r=2*s-o;i=l(r,o,e+1/3),a=l(r,o,e),n=l(r,o,e-1/3)}return[Math.min(Math.floor(256*i),255),Math.min(Math.floor(256*a),255),Math.min(Math.floor(256*n),255)]},rgb2hsl(){r/=255,g/=255,b/=255;const e=Math.max(r,g,b),t=Math.min(r,g,b);let s,i;const a=(e+t)/2;if(e===t)s=0,i=0;else{const n=e-t;switch(i=a>=.5?n/(2-(e+t)):n/(e+t),e){case r:s=60*((g-b)/n+0);break;case g:s=60*((b-r)/n+2);break;case b:s=60*((r-g)/n+4)}}return[s,i,a]},_toggleTool(e,t){1!==t.button&&(t.stopPropagation(),e.toggleClass("active"),null!==this.__$toggleButton&&this.__$toggleButton[0]!==e[0]&&this.__$toggleButton.hasClass("active")&&this.__$toggleButton.removeClass("active"),e.hasClass("active")&&(this.__$toggleButton=e),e.hasClass("active")&&"newcanvas-oekaki"===e.attr("id")?(this.flgs.newcanvas.newcanvas_flg=!0,console.log("this.flgs.newcanvas.newcanvas_flg is ",this.flgs.newcanvas.newcanvas_flg)):(this.flgs.newcanvas.newcanvas_flg=!1,console.log("this.flgs.newcanvas.newcanvas_flg is ",this.flgs.newcanvas.newcanvas_flg)),e.hasClass("active")&&"brush-oekaki"===e.attr("id")?(this.flgs.brush.brush_flg=!0,console.log("this.flgs.brush.brush_flg is ",this.flgs.brush.brush_flg)):(this.flgs.brush.brush_flg=!1,console.log("this.flgs.brush.brush_flg is ",this.flgs.brush.brush_flg)))},_createCanvasWrapper(){const e=this.newCanvasX,s=this.newCanvasY;newFile.id+=1,HIGHEST_Z_INDEX+=1;const i=`<div id ="${newFile.id}" class="file-wrap selected-dot oekaki-canvas" style="transition: ${IS_TRANSITION};">`+'<div class="function-wrapper"><div class="thumbtack-wrapper"></div><div class="resize-wrapper"></div><div class="flip-wrapper"></div><div class="trash-wrapper"></div></div><div class="eve-main is-flipped"></div></div>';t("#add-files").append(i);const a=`#${newFile.id}`,n=t(a);n.css({left:`${e*mouseWheelVal}px`,top:`${s*mouseWheelVal}px`,transform:`translate(${xNewMinus}px, ${yNewMinus}px)`,"z-index":HIGHEST_Z_INDEX}),this.$newCanvasId=n},_updateCanvasVal(){const e=this.$newCanvasId,t=this.newCanvasX,s=this.newCanvasY,i=clientFromZoomX,a=clientFromZoomY,n=Math.abs(i-t),l=Math.abs(a-s);e.css({width:`${n*mouseWheelVal}px`,height:`${l*mouseWheelVal}px`})},_createCanvas(){const{$newCanvasId:t}=this,s=e.createElement("canvas"),i=t.width(),a=t.height();s.width=i,s.height=a;const n=s.getContext("2d");n.canvas.style.touchAction="none",n.fillStyle=this.options.canvas_color,n.fillRect(0,0,i,a),t.find(".eve-main").append(s),t.removeClass("selected-dot")},_drawCanvasPointer(t,s){const i=t[0].getContext("2d"),a=t[0].getBoundingClientRect(),n=s.clientX,l=s.clientY,o={x:(n-a.left)*mouseWheelVal,y:(l-a.top)*mouseWheelVal};let{pressure:r}=s;console.log("e.pressure",s.pressure),void 0===r&&(r=this.options.brush_size);const{buttons:c}=s,{rgb:h}=this,g=`rgba(${h[0]},${h[1]},${h[2]},1)`,u=this.options.canvas_color;if(s.pointerType){switch(s.pointerType){case"touch":case"pen":i.strokeStyle=g,i.lineWidth=r;break;case"mouse":i.strokeStyle=g,i.lineWidth=r,c!==this.EPenButton.barrel&&c!==this.EPenButton.middle||(r=0,i.lineWidth=0)}switch(c===this.EPenButton.eraser&&(i.strokeStyle=u),s.type){case"pointerdown":this.isDrawing=!0,this.lastBrushPos=o;break;case"pointerup":this.isDrawing=!1;break;case"pointermove":if(!this.isDrawing)return;if(c===this.EPenButton.eraser){const e=this.options.eraser_size;i.fillStyle=u,i.fillRect(o.x,o.y,e,e),i.fill()}else if(r>0){i.beginPath(),i.lineCap="round",i.moveTo(this.lastBrushPos.x,this.lastBrushPos.y);const e=this._midPointBetween(this.lastBrushPos,o);i.quadraticCurveTo(this.lastBrushPos.x,this.lastBrushPos.y,e.x,e.y),i.lineTo(o.x,o.y),i.stroke()}this.lastBrushPos=o;break;case"pointerenter":e.body.style.cursor="crosshair";break;case"pointerleave":e.body.style.cursor="default"}}},_drawCanvas(e,t){const s=e[0].getContext("2d"),i=e.getBoundingClientRect(),a=t.clientX,n=t.clientY,l={x:a-i.left,y:n-i.top};if(void 0===l.x||void 0===l.y)return void console.log("WARNING: undefined position");let{pressure:o}=t;switch(console.log("pressure",o),void 0===o&&(o=this.options.brush_size),t.type){case"mousedown":case"MSPointerDown":case"touchStart":this.isDrawing=!0,this.lastBrushPos=l;break;case"mouseup":case"MSPointerUp":case"touchEnd":this.isDrawing=!1;break;case"mousemove":case"MSPointerMove":case"touchmove":if(this.isDrawing){s.lineWidth=o,s.beginPath(),s.lineCap="round",s.moveTo(this.lastBrushPos.x,this.lastBrushPos.y);const e=this._midPointBetween(this.lastBrushPos,l);s.quadraticCurveTo(this.lastBrushPos.x,this.lastBrushPos.y,e.x,e.y),s.lineTo(l.x,l.y),s.stroke()}this.lastBrushPos=l}},_midPointBetween:(e,t)=>({x:e.x+(t.x-e.x)/2,y:e.y+(t.y-e.y)/2})},s}(document,a.a);s(1),s(2),s(3),s(4),s(5),s(6);const o=new n,c=new l(document.getElementById("color-oekaki"));o.load(),c.load()}]);